# 应用授权管理系统改造说明

## 新增功能

1. **用户授权例外设置**
   - 支持针对特定用户设置授权例外规则
   - 通过组织机构授权管理界面进行设置

2. **授权状态可视化**
   - 支持永久授权和临时授权两种模式的直观展示
   - 授权状态通过醒目的颜色标签直观展示

3. **操作列功能优化**
   - 将原独立的"查看其他授权"功能合并到操作列
   - 新增"授权设置"功能入口

4. **授权设置功能**
   - 基于白名单授权模式，默认禁止访问
   - 提供授权开关：开启表示允许访问，关闭表示禁止访问
   - 对于允许访问的情况，可进一步设置永久授权或临时授权
   - 当授权开关从关闭变为开启时，默认选择永久授权模式

## 授权状态判断逻辑

### 判断优先级（从高到低）

1. 如果 `授权类型 = none`
   → **未授权**（灰色标签）

2. 如果 `授权类型 = 永久`
   → **永久授权**（蓝色标签）

3. 如果 `授权类型 = 临时` 且 `开始日期 > 当前日期`
   → **未生效授权**（紫色标签 + 生效日期）

4. 如果 `授权类型 = 临时` 且 `当前日期 > 结束日期`
   → **授权已过期**（灰色标签）

5. 如果 `授权类型 = 临时` 且 `剩余天数 ≤ 7天`
   → **授权即将到期**（黄色标签 + 剩余天数）

6. 如果 `授权类型 = 临时` 且 `剩余天数 > 7天`
   → **临时授权**（绿色标签 + 日期范围）

### 组合授权状态判断

对于组合授权，状态判断逻辑如下：

1. 如果组合授权中包含永久授权
   → **永久授权**（蓝色标签 + 多个时间段）

2. 对于仅包含多个授权时间段的组合授权：

   a. 如果当前日期在所有授权时间段之前
      → **未生效授权**（紫色标签 + 生效日期）

   b. 如果当前日期在所有授权时间段之后
      → **授权已过期**（灰色标签）

   c. 如果当前日期在授权时间段的中间空窗期（即不在任何一个授权时间段内）
      → **授权已过期**（灰色标签）

   d. 如果当前日期在某个授权时间段内，且距离该时间段结束日期 ≤ 7天
      → **授权即将到期**（黄色标签 + 剩余天数）

   e. 如果当前日期在某个授权时间段内，且距离该时间段结束日期 > 7天
      → **临时授权**（绿色标签 + 日期范围）

### 状态说明

| 状态 | 判断条件 | 显示效果 |
|------|---------|----------|
| **永久授权** | 授权类型 = 永久<br>或 组合授权中包含永久授权 | 蓝色标签<br>蓝色标签 + 多个时间段 |
| **未生效授权** | 授权类型 = 临时 且 开始日期 > 当前日期<br>或 组合授权中当前日期在所有授权时间段之前 | 紫色标签 + 生效日期 |
| **授权已过期** | 授权类型 = 临时 且 当前日期 > 结束日期<br>或 组合授权中当前日期在所有授权时间段之后<br>或 组合授权中当前日期在授权时间段的中间空窗期 | 灰色标签 |
| **授权即将到期** | 授权类型 = 临时 且 在有效期内 且 剩余天数 ≤ 7天<br>或 组合授权中当前日期在某个授权时间段内 且 距离该时间段结束日期 ≤ 7天 | 黄色标签 + 剩余天数 |
| **临时授权** | 授权类型 = 临时 且 在有效期内 且 剩余天数 > 7天<br>或 组合授权中当前日期在某个授权时间段内 且 距离该时间段结束日期 > 7天 | 绿色标签 + 日期范围 |
| **未授权** | 授权类型 = none（授权开关关闭） | 灰色标签 |